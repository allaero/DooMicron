####################################################################################################
######################################## MACRO VARIABLES ###########################################
####################################################################################################

[gcode_macro _macroVariables]
description: Central configuration storage for all printer macros and behaviors

####################################################################################################
################################## TEMPERATURE CONFIGURATION #######################################
####################################################################################################

# Default heating temperatures for print operations
variable_extruder_temp: 245                                    # Primary nozzle target temperature
variable_extruder_preheat_temp: 150                            # Nozzle preheat temperature during bed heating
variable_bed_temp: 100                                         # Bed target temperature
variable_temp_tolerance: 5                                     # Temperature tolerance for operations
variable_min_extrude_temp: 180                                 # Minimum temperature for extrusion operations

# PID tuning temperatures
variable_pid_extruder_temp: 210                                # Default extruder PID tuning temperature
variable_pid_bed_temp: 60                                      # Default bed PID tuning temperature
variable_pid_fan_speed_multiplier: 2.55                        # Fan speed multiplier for PID tuning

####################################################################################################
##################################### SPEED CONFIGURATION ##########################################
####################################################################################################

# Motion control speeds
variable_travel_speed: 7500                                    # Default travel speed (mm/min)
variable_default_speed_factor: 100                             # Default speed factor percentage

# Homing and calibration speeds
variable_home_travel_speed: 7500                               # Homing travel speed (mm/min)
variable_home_z_speed: 1000                                    # Z-axis homing speed (mm/min)
variable_home_retract_speed: 2000                              # Homing retract speed (mm/min)

# Print end speeds
variable_end_z_lift_speed: 5000                                # End print Z lift speed (mm/min)
variable_end_retract_speed: 3500                               # End retraction speed (mm/min)

# Preheat positioning speeds
variable_preheat_z_lift_speed: 1000                            # Z lift speed during preheating (mm/min)

# Speed factor behavior
variable_start_speed_factor: False                             # Reset speed factor at print start
variable_end_speed_factor: False                               # Reset speed factor at print end

# Acceleration control
variable_accel_reduction_factor: 0.5                           # Acceleration to deceleration ratio

####################################################################################################
##################################### Z-OFFSET MANAGEMENT ##########################################
####################################################################################################

# Z-offset and calibration behavior configuration
variable_z_offset: 0.0                                         # Default Z-offset adjustment for all prints
variable_start_z_offset: False                                 # Apply Z-offset at print start
variable_end_z_offset: False                                   # Remove Z-offset at print end
variable_offset_store: False                                   # Save Z-offset to config after print

####################################################################################################
################################## CHAMBER CONTROL SYSTEM ##########################################
####################################################################################################

# Chamber heating and environmental control
variable_chamber: True                                         # Enable chamber management
variable_chamber_type: 'temperature_sensor'                    # Chamber sensor type
variable_chamber_name: 'chamber'                               # Chamber sensor configuration name
variable_chamber_temp: 40                                      # Target chamber temperature
variable_chamber_time: 10                                      # Heat soak time in minutes
variable_chamber_temp_tolerance: 25                            # Chamber temperature tolerance

# Heat soaking behavior configuration
variable_heat_soak: True                                       # Enable heat soak functionality
variable_time_soak: False                                      # Use time-based soaking
variable_temp_soak: True                                       # Use temperature-based soaking
variable_heat_soak_fan_speed: 255                              # Part cooling fan speed during heat soak

# Bed temperature control
variable_bed_temp_tolerance: 5                                 # Bed temperature tolerance

####################################################################################################
##################################### BED FAN MANAGEMENT ###########################################
####################################################################################################

# Bed cooling fan control for chamber management
variable_bed_fan: True                                         # Enable bed fan control
variable_bed_fast: 1.0                                         # Fast speed setting (0.0-1.0)
variable_bed_slow: 0.5                                         # Slow speed setting (0.0-1.0)
variable_bed_fan_fast: '_BEDFANSFAST'                           # Macro for fast bed fan speed
variable_bed_fan_slow: '_BEDFANSSLOW'                           # Macro for slow bed fan speed
variable_bed_fan_stop: '_BEDFANSOFF'                            # Macro to stop bed fans

####################################################################################################
################################### IDLE TIMEOUT CONFIGURATION #####################################
####################################################################################################

# Timeout periods for different operational states
variable_idle_time: 2400                                       # Standard idle timeout (40 minutes)
variable_soak_idle_time: 18000                                 # Heat soak timeout (5 hours)

# Component shutdown behavior during idle
variable_idle_extruder: True                                   # Turn off extruder when idle
variable_idle_bed: True                                        # Turn off bed when idle
variable_idle_chamber: False                                   # Keep chamber active when idle
variable_idle_steppers: True                                   # Disable steppers when idle
variable_idle_power: False                                     # Full power shutdown when idle

####################################################################################################
#################################### PARKING CONFIGURATION #########################################
####################################################################################################

# Standard toolhead parking positions and behavior
variable_park_x: 85                                           # X coordinate for parking
variable_park_y: 180                                          # Y coordinate for parking
variable_park_z: 20                                           # Z lift amount for parking
variable_park_zrel: 10                                        # Relative Z lift amount
variable_park_zmin: 20                                        # Minimum Z height for parking
variable_park_speed: 6000                                     # Parking movement speed (mm/min)
variable_park_extrude: 1.0                                    # Extrusion amount during parking
variable_park_base: '_TOOLHEAD_PARK_PAUSE_CANCEL'             # Base parking macro

# Preheat parking positions for heating operations
variable_preheat_x: 85                                        # X coordinate for preheating
variable_preheat_y: 90                                        # Y coordinate for preheating
variable_preheat_z: 10                                        # Z height for preheating

# Maintenance parking positions for service access
variable_maintenance_x: -1                                    # X coordinate for maintenance (-1 = disabled)
variable_maintenance_y: -1                                    # Y coordinate for maintenance (-1 = disabled)
variable_maintenance_z: -1                                    # Z coordinate for maintenance (-1 = disabled)
variable_maintenance_pause_time: 50                           # Maintenance positioning pause time (ms)

# Belt tension testing position
variable_belt_test_y: 117                                     # Y position for belt tension testing  
variable_belt_test_z: 45                                      # Z height for belt tension testing

####################################################################################################
##################################### HOMING CONFIGURATION #########################################
####################################################################################################

# Sensorless homing and axis management
variable_safe_z_enabled: True                                 # Move to safe XY before Z homing
variable_first_homed_axis: 'Y'                                # First axis to home (X or Y)
variable_home_x: 85                                           # Safe X position for Z homing
variable_home_y: 90                                           # Safe Y position for Z homing
variable_z_hop_distance: 5                                    # Z lift distance for homing safety
variable_home_retract: 10                                     # Backoff distance after homing
variable_home_current: 0.0                                    # Reduced current for sensorless homing (0 = disabled)
variable_clear_time: 1.0                                      # Stallguard register clear time (seconds)

# Homing macro assignments
variable_home_x_macro: '_HOME_X'                              # X-axis homing macro
variable_home_y_macro: '_HOME_Y'                              # Y-axis homing macro
variable_home_z_macro: '_HOME_Z'                              # Z-axis homing macro

# Pause and resume macro assignments
variable_pause_macro: 'PAUSE'                                 # Standard pause macro
variable_pause_no_park: 'PAUSE_BASE'                          # Pause without parking macro

####################################################################################################
################################## AIR FILTRATION SYSTEM ###########################################
####################################################################################################

# Nevermore/filter fan configuration
variable_nevermore: True                                      # Enable Nevermore filter control
variable_nevermore_name: 'filter_fan'                         # Filter fan configuration name
variable_nevermore_type: 'fan_generic'                        # Filter fan type
variable_nevermore_speed: 1.0                                 # Filter fan operating speed (0.0-1.0)
variable_use_scrubber: True                                   # Enable VOC scrubbing functionality
variable_scrub_time: 600                                      # Scrubbing duration (seconds)
variable_scrub_speed: 1.0                                     # Scrubbing fan speed (0.0-1.0)
variable_hours_until_replacement: 100                         # Filter replacement interval (hours)
variable_filter_replacement: 'RESPOND MSG="🔄 Replace filter media"'  # Filter replacement notification

# Filter runtime tracking
variable_filter_timer_increment: 1                            # Filter timer increment (seconds)
variable_filter_flush_interval: 300                           # Filter data flush interval (seconds)

####################################################################################################
################################## CONTROLLER FAN MANAGEMENT #######################################
####################################################################################################

# Electronics cooling fan control
variable_controller_fan: False                               # Enable controller fan management
variable_controller_fan_start: '_ELECTRONICSFANSFAST'                 # Macro to start controller fan
variable_controller_fan_stop: '_ELECTRONICSFANSOFF'                   # Macro to stop controller fan

####################################################################################################
################################### EXHAUST FAN MANAGEMENT #########################################
####################################################################################################

# Chamber exhaust fan for post-print air management
variable_exhaust_fan: False                                   # Enable exhaust fan control
variable_exhaust_fan_start: 'EXHAUSTFANFAST'                # Macro to start exhaust fan
variable_exhaust_fan_stop: 'EXHAUSTFANOFF'                  # Macro to stop exhaust fan
variable_exhaust_time: 600                                    # Exhaust operation duration (seconds)

####################################################################################################
################################### PROBE MANAGEMENT SYSTEM ########################################
####################################################################################################

# Docking probe configuration and control
variable_docking_probe: False                                 # Enable docking probe functionality
variable_attach_macro: 'Attach_Probe_Lock'                    # Probe attachment macro
variable_dock_macro: 'Dock_Probe_Unlock'                      # Probe docking macro

####################################################################################################
################################## CALIBRATION PROCEDURES ##########################################
####################################################################################################

# Automatic calibration and leveling systems
variable_auto_z_calibrate: False                              # Enable automatic Z calibration
variable_z_tilt: False                                        # Enable Z-tilt adjustment
variable_qgl: True                                            # Enable quad gantry leveling

####################################################################################################
#################################### BED MESH CONFIGURATION ########################################
####################################################################################################

# Bed mesh generation and management
variable_bed_mesh: True                                       # Enable bed mesh functionality
variable_mesh_adaptive: True                                  # Use adaptive mesh based on print objects
variable_load_mesh: False                                     # Load existing mesh instead of generating
variable_mesh_profile: 'default'                              # Default mesh profile name
variable_mesh_fuzz_enabled: True                              # Enable mesh point randomization
variable_mesh_fuzz_min: 0                                     # Minimum fuzz distance (mm)
variable_mesh_fuzz_max: 4                                     # Maximum fuzz distance (mm)
variable_mesh_min_temp: 30                                    # Minimum temperature for bed meshing

####################################################################################################
################################## NOZZLE CLEANING SYSTEM ##########################################
####################################################################################################

# Automated nozzle cleaning configuration
variable_cleaning: True                                       # Enable nozzle cleaning functionality
variable_clean_probe: True                                    # Clean nozzle before probing
variable_clean_end: False                                     # Clean nozzle after print completion
variable_post_clean_home: False                               # Re-home Z after cleaning
variable_clean_macro: 'CLEAN_NOZZLE'                          # Nozzle cleaning macro

# Cleaning position and motion parameters
variable_nozzle_clean_x: 90                                   # X coordinate for cleaning position
variable_nozzle_clean_y: 189.5                                # Y coordinate for cleaning position
variable_nozzle_clean_z: 0.5                                  # Z height for cleaning operations
variable_nozzle_clean_wipe_axis: 'X'                          # Wiping axis (X or Y)
variable_nozzle_clean_wipe_distance: 30                       # Wiping distance (mm)
variable_nozzle_clean_wipe_quantity: 5                        # Number of wipe cycles
variable_nozzle_clean_wipe_speed: 7500                        # Wiping speed  (mm/min)
variable_nozzle_clean_raise_distance: 10                      # Z lift after cleaning (mm)
variable_nozzle_clean_temp: 150                               # Cleaning temperature (°C)
variable_nozzle_clean_hot: True                               # Clean at operating temperature
variable_nozzle_clean_z_speed: 1500                           # Z movement speed for cleaning  (mm/min)

####################################################################################################
################################## FILAMENT CUTTING SYSTEM #########################################
####################################################################################################

# Automated filament cutting using gantry depressor
variable_filament_cut_safe_x: 11                              # Safe X position for cutting approach
variable_filament_cut_safe_y: 140                             # Safe Y position for cutting approach
variable_filament_cut_safe_z: 2                               # Safe Z clearance for cutting
variable_filament_cut_init_x: 4                               # Initial X position for cut sequence
variable_filament_cut_init_y: 152                             # Initial Y position for cut sequence
variable_filament_cut_y: 179.5                                # Final Y position to execute cut
variable_filament_cut_retract: 5                              # Filament retraction after cut (mm)
variable_filament_cut_speed: 600                              # Cutting motion speed (mm/min)
variable_filament_cut_approach_speed: 3000                    # Approach movement speed (mm/min)
variable_filament_cut_retract_speed: 300                      # Retraction speed after cutting (mm/min)

# Tip shaping parameters
variable_tip_tune_1: 1                                        # Extrude and retract 1
variable_tip_tune_2: 5                                        # Extrude and retract 2
variable_tip_tune_3: 8                                        # Final retract
variable_post_cut_push: 5                                     # Extrude post cut to move filament below blade

####################################################################################################
##################################### PURGE CONFIGURATION ##########################################
####################################################################################################

# Nozzle purging system for print preparation
variable_purge_x: 68                                          # X coordinate for purge location
variable_purge_y: 175                                         # Y coordinate for purge location
variable_purge_z_offset: 0.5                                  # Z height for purge operations
variable_purge_z_clearance: 9.5                               # Z clearance for purge approach
variable_cleanup_x: 54                                        # X coordinate for cleanup location
variable_cleanup_y: 143                                       # Y coordinate for cleanup location
variable_purge_z_height_1: 1                                  # First purge height level
variable_purge_z_height_2: 6                                  # Second purge height level
variable_purge_z_height_3: 9                                  # Third height level for cooling
variable_purge_extrude_1: 15                                  # First level extrusion amount
variable_purge_extrude_2: 55                                  # Second level extrusion amount
variable_purge_mid_retract: 10                                # Mid-purge retraction for clean separation
variable_purge_pause_time: 10000                              # Cooling pause duration (ms)
variable_purge_prime: 0                                       # Priming amount before purge

# Purge speed configuration
variable_purge_slow_speed_1: 60                               # Base formation speed (mm/min)
variable_purge_slow_speed_2: 75                               # Height building speed (mm/min)
variable_purge_slow_speed_3: 50                               # Final height speed (mm/min)
variable_purge_z_lift_speed: 600                              # Z lift speed after purge (mm/min)
variable_purge_z_speed: 3000                                  # General Z movement speed for purge (mm/min)
variable_purge_cleanup_speed: 2000                            # Cleanup movement speed (mm/min)
variable_purge_final_lift: 0.5                                # Final Z lift amount

# Purge fan and cooling
variable_purge_cooling_fan_speed: 255                         # Cooling fan speed during purge

# Line purging configuration for slicer integration
variable_purging: True                                        # Enable purge functionality
variable_purge_macro: '_NOZZLE_PURGE'                         # Purge execution macro
variable_purge_adaptive: True                                 # Use adaptive purge positioning
variable_purge_z_height: 0.4                                  # Purge line height
variable_purge_tip_distance: 3                                # Tip priming distance
variable_purge_amount: 20                                     # Total purge extrusion amount
variable_purge_flow_rate: 10                                  # Purge flow rate
variable_purge_distance_x: 10                                 # X distance from print objects
variable_purge_distance_y: 0                                  # Y distance from print objects
variable_purge_size: 10                                       # Purge pattern size
variable_purge_debug: False                                   # Enable purge debugging output

# Purge retraction configuration
variable_purge_retract_small: 0.5                             # Small retraction amount
variable_purge_retract_speed: 2000                            # Purge retraction speed (mm/min)
variable_purge_retract: 8                                     # Post-purge retraction
variable_purge_mini_retract: 1                                # Mini retraction amount

####################################################################################################
################################### END PRINT CONFIGURATION ########################################
####################################################################################################

# Print completion behavior and cleanup
variable_end_print: True                                      # Enable end print sequence
variable_end_retract: True                                    # Retract filament at print end
variable_end_retract_length: 15                               # End retraction distance (mm)
variable_end_raise: 5                                         # End print relative raise height (mm)
variable_power_off: False                                     # Auto power-off after print
variable_off_macro: 'POWER_OFF'                               # Power off macro
variable_end_filament_cut: True                               # Cut filament at print end
variable_end_unload: True                                     # Full filament unload at print end

####################################################################################################
################################# FILAMENT CONTROL SYSTEM ###########################################
####################################################################################################

# M600 filament change configuration
variable_filament_m600_default_temp: 245                      # Default M600 operating temperature
variable_filament_m600_idle_time: 3600                        # M600 filament change timeout (60 minutes)
variable_filament_m600_coldstart: 0                           # M600 cold start flag

# Filament handling speeds and distances
variable_filament_m600_slow_speed: 250                        # Slow extruder movement speed (mm/min)
variable_filament_m600_fast_speed: 1000                       # Fast extruder movement speed (mm/min)
variable_filament_m600_unload_length: 80                      # Unload retraction distance
variable_filament_m600_purge_length: 70                       # Purge extrusion amount
variable_filament_m600_unload_speed: 1000                     # Unload operation speed (mm/min)

# Filament sensor configuration
variable_auto_filament_sensor: True                           # Enable automatic sensor management
variable_auto_filament_delay: 3                               # Sensor activation delay (seconds)
variable_auto_filament_delay_ms: 3000                         # Sensor activation delay (milliseconds)
variable_upper_filament_sensor: 'upper_Filament_Sensor'       # Upper sensor configuration name
variable_lower_filament_sensor: 'lower_Filament_Sensor'       # Lower sensor configuration name

# Filament loading configuration
variable_post_filament_load: 20                               # Final loading distance after sensor detection
variable_auto_unload: True                                    # Automatic unload on runout
variable_auto_load: True                                      # Automatic load on insertion
variable_auto_color_change: 0                                 # Force nozzle purge for automated swaps (0=smart, 1=always nozzle purge)

# Filament change parking positions
variable_filament_park_x: 90                                  # X coordinate for filament operations
variable_filament_park_y: 10                                  # Y coordinate for filament operations

# Filament loading speeds and control
variable_filament_load_increment: 1                           # Incremental loading distance (mm)
variable_filament_max_extrusion_distance: 80                  # Maximum extrusion safety limit (mm)
variable_filament_grab_distance: 2                            # Distance to grab inserted filament (mm)
variable_filament_extrusion_delay: 0.1                        # Delay between extrusion attempts (seconds)
variable_filament_insertion_check_delay: 0.1                  # Delay between insertion checks (seconds)

# Filament operation speeds
variable_filament_retract_speed: 2000                         # General filament retraction speed (mm/min)
variable_filament_slow_speed: 1000                            # Slow filament operation speed (mm/min)

# Print start filament configuration
variable_print_start_prime_factor: 0.8                        # Prime amount factor for print start
variable_prefill_factor: 0.00001                              # Prefill amount factor

####################################################################################################
#################################### OUTPUT CONFIGURATION ##########################################
####################################################################################################

# Status output and feedback systems
variable_output: 118                                          # Primary output method (116/117/118)
variable_error_output: 118                                    # Error message output method
variable_state_restore_speed: 1000                            # State restoration speed

####################################################################################################
##################################### LED STATUS SYSTEM ############################################
####################################################################################################

# LED status indication configuration
variable_led_status: True                                     # Enable LED status system
variable_status_standby: '_STATUS_STANDBY'                     # Standby status macro
variable_status_calibrating: '_STATUS_CALIBRATING'             # Calibration status macro
variable_status_cooling: '_STATUS_COOLING'                     # Cooling status macro
variable_status_heating: '_STATUS_HEATING'                     # Heating status macro
variable_status_m600: '_STATUS_M600'                           # M600 status macro
variable_status_finished: '_STATUS_FINISHED'                   # Print finished status macro
variable_status_error: '_STATUS_ERROR'                         # Error status macro
variable_status_printing: '_STATUS_PRINTING'                   # Printing status macro

####################################################################################################
#################################### AUDIO FEEDBACK SYSTEM #########################################
####################################################################################################

# Audio notification configuration
variable_audio_status: False                                  # Enable audio feedback system
variable_error_audio: '_GAME_OVER_TUNE'                       # Error audio macro
variable_success_audio: '_MARIO_TUNE'                         # Success audio macro
variable_filament_m600_audio: '_CHANGE_TUNE'                  # M600 audio notification macro
variable_alert_frequency: 5                                   # Alert frequency setting

####################################################################################################
################################### TEST SPEED CONFIGURATION #######################################
####################################################################################################

# Speed testing parameters
variable_test_speed_bound: 20                                 # Safety boundary for speed tests (mm)
variable_test_speed_small_pattern: 20                         # Small pattern size for speed tests (mm)
variable_test_speed_safe_move_speed: 30                       # Safe movement speed for speed tests
variable_test_speed_pause_time: 1000                          # Pause time during speed tests (ms)

####################################################################################################
################################### EMERGENCY PROCEDURES ###########################################
####################################################################################################

# Emergency operation parameters
variable_emergency_z_raise: 10                                # Emergency Z raise distance (mm)
variable_emergency_z_speed: 10                                # Emergency Z movement speed

####################################################################################################
#################################### DEBUGGING CONFIGURATION #######################################
####################################################################################################

# Debug output and troubleshooting controls
variable_debugging: False                                     # Enable debug output
variable_debug_level: 0                                       # Debug verbosity level
variable_use_fluidd: True                                     # Enable Fluidd-specific features

####################################################################################################
##################################### ⚠️ INTERNAL STATE VARIABLES ⚠️ ##############################
####################################################################################################
# DO NOT MODIFY - These variables are managed automatically by the macro system

variable_currently_printing: 0                                # Current print state (auto-managed)

# Filter maintenance tracking
variable_filter_time: -1                                      # Filter runtime accumulator (seconds)

# Material and print tracking
variable_material_type: 'ABS'                                 # Current material type
variable_material_color: 0                                    # Current material color code
variable_layer_count: 0                                       # Total layer count for current print
variable_layer_num: 0                                         # Current layer number
variable_layer_z: 0                                           # Current layer Z height
variable_nozzle_diameter: 0                                   # Current nozzle diameter
variable_tool_count: 0                                        # Number of tools/extruders
variable_tool_name: 'default'                                 # Current tool configuration name

# M600 operation state tracking
variable_runout: 0                                            # Filament runout detection flag
variable_filament_m600_prev_temp: 0                           # Previous extruder temperature storage
variable_heat_soak_complete: 0                                # Heat soak completion flag
variable_starting_print: 0                                    # Print start process flag

# TMC driver type detection
variable_tmc_x: 'tmc2209'                                     # X-axis TMC driver type
variable_tmc_y: 'tmc2209'                                     # Y-axis TMC driver type

# Sensor state tracking
variable_upper_sensor_state: 0                                # Upper filament sensor state
variable_lower_sensor_state: 0                                # Lower filament sensor state

# Print state flags
variable_flag_end_unload: False                               # End print unload flag
variable_flag_end_retract: False                              # End print retract flag

gcode:
    # No G-code required - this macro only stores variables


####################################################################################################
################################## MAINSAIL CLIENT VARIABLES #######################################
####################################################################################################

[gcode_macro _CLIENT_VARIABLE]
description: Mainsail/Fluidd web interface integration variables

# Custom parking configuration for web interface
variable_use_custom_pos: True                                 # Enable custom park coordinates
variable_custom_park_x: 90.0                                  # Custom X park position
variable_custom_park_y: 180.0                                 # Custom Y park position
variable_custom_park_dz: 5.0                                  # Custom Z lift for parking

# Filament handling for pause/resume operations
variable_retract: 5.0                                         # Retraction amount during PAUSE
variable_cancel_retract: 5.0                                  # Retraction amount during CANCEL_PRINT
variable_speed_retract: 35.0                                  # Retraction speed (mm/s)
variable_unretract: 5.0                                       # Unretraction amount during RESUME
variable_speed_unretract: 35.0                                # Unretraction speed (mm/s)

# Movement speeds for web interface operations
variable_speed_hop: 15.0                                      # Z-hop movement speed (mm/s)
variable_speed_move: 100.0                                    # XY movement speed (mm/s)

# Cancel print behavior configuration
variable_park_at_cancel: True                                 # Park toolhead during CANCEL_PRINT
variable_park_at_cancel_x: 90.0                               # Cancel park X position
variable_park_at_cancel_y: 180.0                              # Cancel park Y position

# Firmware retraction integration
variable_use_fw_retract: False                                # Use firmware retraction (requires [firmware_retraction])

gcode:
    # No G-code required - this macro only stores variables
    